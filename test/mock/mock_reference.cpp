// Copyright (c) 2016 Daniel Cooke
// Use of this source code is governed by the MIT license that can be found in the LICENSE file.

#include "mock_reference.hpp"

#include <iterator>
#include <algorithm>
#include <stdexcept>

#include "utils/map_utils.hpp"

namespace octopus { namespace test { namespace mock {

MockReference::MockReference()
{
    mock_contigs_.emplace("1",
                          "TAAGATGAAATCTACAAAATTTAACACAAATCCATTATCTTGATCATTATTATCAATAATAATTCAATTCCATGCCTGTACATTCTACTCTAAAATGCTTCCTGTGTGAACTTAAGTTTTGTTATTCACTTACTTGCTTTAAATTTCCTCTAAATATTACATTGATTGTTTATAATCTGCCATTGCTTTTCTCTCTTGCCTCATGTCTCACCAGTTCCCACCAAGGACTACATGTTTCTGCCCTGCAGCATCACTGAATTTTCTTGTAAAATGCTATTTCTCCATTATCTTCCAATGTTGGTTTTTATTCTTAACTATACCGAGAATACCTTTCTCCACCTCTTCTTTCCCATGACCATTCTCATCTCCCACCCTTTCCAAATATAGTTCCTATTCAATTTTCAAGCCAAAACTCTTCTCCTAAGAGAACCTAGGAGATGGCTAGTATTTATCATCCCACTTTTGTAAATACTTGTTTGCTATCTATATCTCCAACTGGA"
                          );
    
    mock_contigs_.emplace("2",
                          "ACCCGGGAGGCAGAGGTTGCAGTGAGCCGAGAACACAGCACTGCACTCCAGCCTGGGTGACAGAGCAAGACTCCATTTCAAAAAAAAAAAAAAAAAAAAAAGAAAAGAAAAGCTAGACAAATTAAAAAGTGGTTACTTCTTTTCTTGGATTCATCATAGAACAGGTCATACAGCAAACTACCACTCTGAAATCTAGAAAGACAGTCTTACTTAAAGAAATGGAGCAACTGAGATCTGCTTATCTAGGGCCAAAGTTCCTGTAACTATAAACTGCTGGGTGCATGTAAATGGTAATTTAAATTAATTCTGGAGACTTGGTATGAACTGGCATGAATGAAAAATGCCTAGATTCTTATTTGTATCTTCATAGTTTCATAGGCTTCCCCTCCAGGAAGTCATAGGTTTTGATGGGATCCAAGAAAGATCACTTCTTCTCTCTGGCATAGGAAGAAGAGTGACTATTGTGAACAGTGCCTAGTGCCTTCTCCAGAATATATGAGTAATCTCCAGGGAAAAGGGCTTTACAAGAGAGCAATTCAGAAATTTTATCCTAGCTGGGAGAATGAATCTCCTCTTCACACAAAGCTTCTCCTGCTATTCTAGCTTACCTAAGGGGGGAAGGTTAAACAAAATTACAGACAATAAGGTTCCAGACTTCAAGAAAACAGAAATAGAACATTCTTACTGGAAAAAAATAGTATGGTACAGGGGAGGGGAAAGGGAGAGCATTGACAGAATACTTGTGAAATTAAGGGAACCAAAACAAAGGTCTCTAAAAGACTGGGACTTAAAAGAATATAGAATATTTCCCCTACCATACATCTCACCACCAAACCAACAAGGCTTCAATATAACAGTGAATTACATATTTTAAAAGATTAAAGAAACAAATTCTACAAGAAGAGTACATATGAAAACGCAAGAGAAAAAATAAAAATATGAACACTAGAAAGATCTTAAATCCTTACCTATATCTTTAACAAGCATTAAACAGAGCAAA"
                          );
    
    mock_contigs_.emplace("3",
                          "CAGGAGATCGAGACCATCCTGGCTAACACGGTGAAACCCTGTGTCTACTAAAAATACAAAAACAAAATTAGCTGGGCGTGGTGGCGGGTGCCTGTGGTCCCAGCTACTTGGGAGGCTGAGGCAGGAGAATGGCGTGAACCTGGGAGGCGGAGCTTGCAGCGAGCCCAGATCACACCACTGCACTCCCGCCTGGGCAACACGGCAAGACTCAGTCTCAAAAAAAAGAAATTAGTTGATATATCCTATGGTGGTGAAAATGGATTCAACCAAGCTGTTGGGCTATCTACTGAAGTCCTCTCCAAAGTGAAATTTATTCAAAAGAAGAAATTAGTAGGGATACATTGATGAAATCAGCCAGGACACAGGCAGGTACTGTTTTGGTGTTGAAGATACACTAAAGGCTTTGGAAATGGGAGCTGTAGAAATTCTAATAGCCTATGAAAATCTGAATATAATGAGATATGTTCTTCATTGCCAAGGCACAAAAGAGGAGAAAATTCTCTAACTCCAGAGCAAGAACAGGATAAATCTCATTTCACAGACAAAGAGACCAGGCAGGAACATGCGCTTATCAAGAGCATGCCCCTGTTGAAATGGTTTGCTAACAACTATAAAAAAGTCGGAGCTACATTGGAAATTGTCACATATAAATCACAAGAAGGGTCTCAGTTTGTGAAAGGATTTGGTAGAATTGGAGGTCTCTTGTGGTACCAAGTGGATTTCCAAAGAATGGAATACCAAGGAGGAGACGATGAATTTTTTTACCTTGATGACTACTAGGTAGTCGACATGGGTCCGGCAAAACATGCCTCACTCTCCAGCATCCAACCCAAGGAGCATACTCATGATGGAATCCAAACAGATCCCTGCCTTACAATTGGAACATTTCCAGAACTTAATCCATGAGCACTGGATATTGAAAAGAAAACAGAAACAAAACCAGACCCAACCCTACACTTTGGTTTGTCACGGTGTCAGCGTAGCAGCCTACAACTAAGTTCCTAAATGCCACTTTGGACTAATTTAAAAAAGAATCCCAGTTTTTACTTTTACTCGATGGTGAAATTGGCTGCTCTTGTATTTTATTTAAAAAATGATTTTTTTAACCTTTATACAAATAAGCAAAAATACTTTAACTGCTGTAAACCTTCAAAAGTTAATAGAAGTGAGATCGTACTGCTTTCTTATTTTGATTGGAGAGAAATTAAATTGCTACATTTTGCAGTGACCCATTTACATGGCATTCTCAGCTTAGACTGCATAAGAAGAAATATATGTGGTGAAATGTTGGAACCATTTCTCTCTTGGTCTCTGTTTAATGATGAAAGAGTGAGCTAATAGGAGGCAATTTCAACTTCACTCCCTCACGCTACCCCTTCCCCCTCCAGACTGGCCGTTTCAAGGATGAAAATTGCATTGCAAAATCAAACTGACTCATGAAGCATTTGGGCCAGTGCACTGTTTACTTCCATCTGTTTGCAGACACATTTGTGCCCGGTGTTTGGGAGCTCTTTGTATCAATGTTCCGACAAGGGTCCCAATAACCTTAACCTACTCGAAACCAGTTTGGGATGGATATGATGGGGCTTCTGTGCTATTGCTGGGATTGGGAGAAATAAAACATGCAATTTAAGTGGAAGCAAAACAATTAAAAATAAAATAAATAAATCCATTGCCTGATTCCATGTCTCCCTCCAATTACCGCCCCATTTCTCTGACACTCCTTATAGAATAATTCCTTAGTCAATTGTCTCATGATGTTTTTAATATATCAAATGGATTTATGGACAGTGTTTCAAAAGCCAAATACTTCTACAAGGCTTGTTATGAACACAGATGTCCCCAATCTTTCATGTACACCATTTCCTGAATCCTAGAGGCAATCTACTTTATTCTGCCTAATTTTTTGATCGTTACATCTGTGCCTCCAAATAGTGTGTTATAGTGCCGTTTTGTTTTTCACTCTTATGTATCATCCTTAGTGTATAGCTCCCTTTCAT"
                          );
    
    mock_contigs_.emplace("4",
                          "TGCCCCGCCCCGGCCTCGCCACGCCCCTACCTCACCACGCCCCCCGCATCGCCACGCCCCCCGCATCGCCACGCCTCCCTTACCATGCAGTCCCGCCCCGTCCCTTCCTCGTCCCGCCTCGCCGCGACACTTCACACACAGCTTCGCCTCACCCCATTACAGTCTCACCACGCCCCGTCCCCTCTCCGTTGAGCCCCGCGCCTTCGCCCGGGTGGGGCGCTGCGCTGTCAGCGGCCTTGCTGTGTGAGGCAGAACCTGCGGGGGCAGGGGCGGGCTGGTTCCCTGGCCAGCCATTGGCAGAGTCCGCAGGCTAGGGCTGTCAATCATGCTGGCCGGCGTGGCCCCGCCTCCGCCGGCGCGGCCCCGCCTCCGCCGGCGCAGCGTCTGGGACGCAAGGCGCCGTGGGGGCTGCCGGGACGGGTCCAAGATGGACGGCCGCTCAGGTTCTGCTTTTACCTGCGGCCCAGAGCCCCATTCATTGCCCCGGTGCTGAGCGGCGCCGCGAGTCGGCCCGAGGCCTCCGGGGACTGCCGTGCCGGGCGGGAGACCGCCATGGCGACCCTGGAAAAGCTGATGAAGGCCTTCGAGTCCCTCAAGTCCTTCCAGCAGCAGCAGCAGCAGCAGCAGCAGCAGCAGCAGCAGCAGCAGCAGCAGCAGCAGCAACAGCCGCCACCGCCGCCGCCGCCGCCGCCGCCTCCTCAGCTTCCTCAGCCGCCGCCGCAGGCACAGCCGCTGCTGCCTCAGCCGCAGCCGCCCCCGCCGCCGCCCCCGCCGCCACCCGGCCCGGCTGTGGCTGAGGAGCCGCTGCACCGACCGTGAGTTTGGGCCCGCTGCAGCTCCCTGTCCCGGCGGGTCCCAGGCTACGGCGGGGATGGCGGTAACCCTGCAGCCTGCGGGCCGGCGACACGAACCCCCGGCCCCGCAGAGACAGAGTGACCCAGCAACCCAGAGCCCATGAGGGACACCCGCCCCCTCCTGGGGCGAGGCCTTCCCCCACTTCAGCCCCGCTCCCTCACTTGGGTCTTCCCTTGTCCTCTCGCGAGGGGAGGCAGAGCCTTGTTGGGGCCTGTCCTGAATTCACCGAGGGGAGTCACGGCCTCAGCCCTCTCGCCCTTCGCAGGATGCGAAGAGTTGGGGCGAGAACTTGTTTCTTTTTATTTGCGAGAAACCAGGGCGGGGGTTCTTTTAACTGCGTTGTGAAGAGAACTTGGAGGAGCCGAGATTTGCTCAGTGCCACTTCCCTCTTCTAGTCTGAGAGGGAAGAGGGCTGGGGGCGCGGGACACTTCGAGAGGAGGCGGGGTTTGGAGCTGGAGAGATGTGGGGGCAGTGGATGACATAATGCTTTTAGGACGCCTCGGCGGGAGTGGCGGGGCAGGGGGGGGGCGGGGAGTGAGGGCGCGTCCAATGGGAGATTTCTTTTCCTAGTGGCACTTAAAACAGCCTGAGATTTGAGGCTCTTCCTACATTGTCAGGACATTTCATTTAGTTCATGATCACGGTGGTAGTAACACGATTTTAAGCACCACCTAAGAGATCTGCTCATCTAAGCCTAAGTTGGTCTGCAGGCGTTTGAATGAGTTGTGGTTGCCAAGTAAAGTGGTGAACTTACGTGGTGATTAATGAAATTATCTTAAATATTAGGAAGAGTTGATTGAAGTTTTTTGCCTATGTGTGTTGGGAATAAAACCAACACGTTGCTGATGGGGAGGTTAATTGCCGAGGGATGAATGAGGTGTACATTTTACCAGTATTCCAGTCAGGCTTGCCAGAATACGGGGGGTCCGCAGACTCCGTGGGCATCTCAGATGTGCCAGTGAAAGGGTTTCTGTTTGCTTCATTGCTGACAGCTTGTTACTTTTTGGAAGCTAGGGGTTTCTGTTGCTTGTTCTTGGGGAGAATTTTTGAAACAGGAAAAGAGAGACCATTAAAACATCTAGCGGAACCCCAGGACTTTCCCTGGAAGTCTGTGTGTCGAGTGTACAGTAGGAGTTAGGAAGTA"
                          );
    
    mock_contigs_.emplace("5",
                          "TCCCTTTGGGGTTTCCTCCCAAAAACCCATGACTCCAGTCTAATCGTGAGAAAAACATCAGATAAATCCCAACTGAGAAACATTCTACAAAATATCTGACCAGTACTCCTCAAACCTATCAAGGTCATCAAAAACAAGAAAAGTTTGAGAAACTGTCACAGCCAACAGGAGCTTAAGGAGACATAACTAAATGTAATATAGTATCTTAGATAGGATACTGAAACATTAGGTAAAAACTAACGAGACCTTAATAAAGTATGGACTTTAAGTTAATAATAATGAATCCATGTTGGTTCGTTAATTGTAACAAATGTACTACAGTCATGTAAGCTACTAATAACAGGGGAAACTAGGTACAAAGTACATGGGAACTCTCTGCCCTATATTTGCGATTTTTCTTTAAATATAAAACTGTTCTAAATAAAAGTTCATTAAAAATGCTTATCAAAATATTTTGAAAACATTTTTAAATGATGCTCAATTGGTAGTGATACCTTGTCAACAATTAACCCCTGAGGAAATCTCTGTCCCAACAGAGGCTACATACAGAACTGGGGGATTCAGATCCACTGGTACAGGTAGCTTAAATCCTGGAGCCAAAATATGGGTAGAGTGTCCATCAGATCCCGCCCCTAAGGCTGGTGACCTTGTAGCTATGGGAGCAGAAAATGAAGGCATAGTACAATTTCCTAAAGATTAAAAACAATATCATGTTCTCCTCCATTTTTGTTATTACAGGGAATAACCTATCTACTAATGATCAGCACCTGTGTCTTTGTGTCTGAGGCCAAGAATAAATTCATCAACTGGGTAGCCACTACAGCAGAAGAAGCCAACCACAGTCAATGTTGACTACGCGTCAAGTTGCCAGAGGCCACAGGAAATGGACTACCTTGGAGAATCATCCCTGCCAACATTTCTGAATGGCTATGTCACTACCAATGGGGCCACAACAACAACACTTGCAACCCAACCTGGACTTCCTTTGACCAAAGGAAGAAATCTATCTTTGCCCATGTCAGACGAAAGGTGAACACCACCCTTGCCTTGTGTCAAAAGCTTTGGTATCCTGCCCAATATGCCTGGAACAGTATATATTGGGAAACTGCTGTGCTGGTGGCCAGATTCCATATAGCCCCCCACTTTGTCTGGAGGCCTTAAATGGCTCCTCTAATGTTACTCTGGGGTTTCTCCTGCCAGACAACTGTCAACACATACTCGAAATCAACAACATTGTCCCCAGTGAAACACAATCTCTTTCCTGCTTTAATAACACCTTAATACACTATAATTACAAAAAAACCATTGCTGTACCCTGGTGGGGGCCCTGTGGGTATGCAGATCCTACGAGTGGCAATACCTGCCCCCACATTGGATGGGGAGATGCACTTAGAGGTGGCCATTAATTCCATTCACCATCCAGGATAATATTCCCCTCCCCAGTAATCTGGACTCCCTGGTGGTGGTACCCTATCACAGTATTCTCCCCTGCCACCGGTACAATCCTGCTTCAGCAAAAAATTAAAATATTAAGCTTACATGTAGAAGAAGCTCTTAATGATAGTAGCATTGGACTTATGTTGCTATCAAATGAATTTGCTCAGCTGTGTACTGTTGTGTTACAAAATCGAATGGCATTAGATATGCTTACCGCAGCCCAAGGAGGGGTTTGTGCCTGACTGCATACTGAATGTTATGTGTATATCCCTGATAATTCTCACAATATCACTCTCCTTGAAAAGCCATGGTGGGTGTGGTTTTTATTAATTGTGCTTTTAATTCTCCTGTGCTTATCCTGTATCTGTAATCTGTATCAACTATGCCTTCCCCATGTATCTGTAAGGGTATTTTTCTACAATTGAGTATCAAATTGAGGCTGAGTGTGGAGGAAAAGTTAAATATTAAATTTGAACTCAATTGAACATGACACAAACGATGGTCACCAAGTCCCAGAACAGGTTGTGTGAGCCCCTTGAGGCGCTCATCCAGTGCTGATTCGG"
                          );
    
    mock_contigs_.emplace("6",
                          "TCTTCTTTAAACTGGTTATTCTAGTTAGCAATTCGTTTAACCTTTTTTCAAGATTCTTAGCTTCCTCGCATTGGGTTAGAACATGCTTCTTTAGCTCGGAGGAATTTGTTATTACCCGCCTTCTGAAGCCTACTTCTGTCAATCTGCTCCTTTAGCTCAGAGGAGTTTGTTATTACCCACCTTCTGAAGCCTACTTCTGTCAATTCGTCAAACTCATTCTCCATCCAGTTTTGTTCCCTTGCTGGTGAGGAGTTGTGATCCTTTGGAGGAGGAGAGGCATTCTGGTTTTTGGAATTTTCAGCCTTTTTGCAGTGGTTTCTCCCTATCTTCGTGGATTTATCTACCTTTGGTCTTTGAAGTTGGTGACCATCAGAGGGGGTCTCTGAGTAGATGTCCTTTTTGTTGATGTTGATGCTATTCCTTTCTGTTTGTTAGTTTTCCTTCTGACAGTCAGGCCCTCTGCTGCAGGTTTGCTGGAGTTTGCTGGAGATCCTGTTTGCCTGAGTATCACTGGCAGAAGCTGCAGAACAGCAAAGATTGCTGCCTCTTTTTCCTCTGGAAGCTTTGTCCCAGAGGGGCACCCGCCATATGCCAGCCAGAGCTCTCCTGTCTGAGGTGTCTGTCGGCCCCTACTGGGAGGTATCTCCCAGTCAGGATACATGGGGGTCAGGGATCATGAGGAGGCATTCTGTCCCTTATCAGGGCTTGAACGCTGTGCTGGGAGATCTGCTGCCCTCTTCAGAGCTGCCAGACAGGGACGTTTAAGTCTGCTGAAGCTTGGCCCACAACCGCCCCATCCCTCAGGTGCTCTGTCCCAGGGAGCTGGGGGTTTTAACTATAAGTTCCTAACTGGGGCTGCTGCCATTTTTTCAGAGATGCCCTGCCCAGAGAAGAGGGAATCTAGAGGGGCAGTCTGGCTGCAGAGGCCTTGCTGAACTGCAGTAGGATCCACCCAGTTTGAACTTCCCGGTGGCATTGTTTACACCGTGAAGGTAAAACC"
                          );
}

std::unique_ptr<ReferenceReader> MockReference::do_clone() const
{
    return std::make_unique<MockReference>(*this);
}

bool MockReference::do_is_open() const noexcept
{
    return true;
}

std::string MockReference::do_fetch_reference_name() const
{
    return "mock";
}

std::vector<MockReference::ContigName> MockReference::do_fetch_contig_names() const
{
    auto result = extract_keys(mock_contigs_);
    std::sort(std::begin(result), std::end(result));
    return result;
}

MockReference::GenomicSize MockReference::do_fetch_contig_size(const ContigName& contig) const
{
    return static_cast<GenomicSize>(mock_contigs_.at(contig).size());
}

MockReference::GeneticSequence MockReference::do_fetch_sequence(const GenomicRegion& region) const
{
    const auto& contig = mock_contigs_.at(contig_name(region));
    
    auto first = std::next(std::cbegin(contig), region.begin());
    
    if (region.end() > contig.size()) {
        throw std::runtime_error {"MockReference: out of bounds"};
    }
    
    auto last  = std::next(std::cbegin(contig), region.end());
    
    return {first, last};
}

ReferenceGenome make_reference()
{
    return ReferenceGenome {std::make_unique<MockReference>()};
}

} // namespace mock
} // namespace test
} // namespace octopus
